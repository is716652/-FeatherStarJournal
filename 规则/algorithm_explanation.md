# 演禽通纂 - 核心排盘算法详解

## 1. 基础概念

演禽排盘的核心在于确定**“主星”**（又称“禽星”），并由此推导出胎星、命星、身星等一系列星宿，再结合流年、流月、流日、流时的星宿（“流星”），通过吞啖、化道等规则判断吉凶。

## 2. 核心计算步骤

### 2.1 起旬头 (Determining the Decade Head)

演禽以“六十甲子”为基础，每10年为一旬。首先需要确定出生年份所属的“旬头”以及该旬头对应的星宿。

**规则**：
1.  **寻找旬头**：若生年为甲子旬，则旬头为甲子；否则，倒数天干至“甲”字，即为旬头。
    *   例：辛卯年 -> 辛,庚,己,戊,丁,丙,乙,甲 -> 甲申旬。
2.  **确定元运**：演禽分上、中、下三元（需结合具体年份判断元运，通常 1864-1923 上元，1924-1983 中元，1984-2043 下元，此处需根据实际通书校对，或默认循环）。
3.  **旬头星宿对照表**：

| 旬头 | 上元 | 中元 | 下元 |
| :--- | :--- | :--- | :--- |
| **甲子** | 箕水豹 | 鬼金羊 | 角木蛟 |
| **甲戌** | 昴日鸡 | 心月狐 | 危月燕 |
| **甲申** | 轸水蚓 | 娄金狗 | 井木犴 |
| **甲午** | 虚日鼠 | 张月鹿 | 房日兔 |
| **甲辰** | 参水猿 | 斗木獬 | 奎木狼 |
| **甲寅** | 氐土狢 | 毕月乌 | 星日马 |

### 2.2 起主星 (Master Star) & 胎星 (Embryo Star)

**主星**是命盘的核心，代表命主自己。

**计算公式**：
1.  **定位旬头星**：根据生年找到旬头星。
2.  **顺数至生月**：从旬头星开始，按二十八宿顺序（角亢氐房心尾箕...）顺数，**日数 = 生月数字**（正月=1，二月=2...）。
    *   *注意：此处原文“以初八日除八数”可能有误或特指日禽。通常演禽排盘主星计算为：旬头星 + (生月-1) + (生日-1)？不，原文算法较独特，需仔细解读。*
    *   **原文解读修正**：
        *   原文：“以初八日除八数...却寻宫归子...到巳为住。” -> 这似乎是在数宫位。
        *   **更通用的演禽算法（参考）**：
            1.  **定年禽**：由三元甲子定出年干支对应的禽星。
            2.  **定月禽**：由年禽推月禽（有口诀，如“会气”）。
            3.  **定日禽**：这是最常用的“主星”，即万年历中的“值日星宿”。
            4.  **定时禽**：由日禽推时禽。
        *   **本书（演禽通纂）特定算法**：
            *   似乎是用“五虎遁”起月建，结合旬头星来定。
            *   **步骤**：
                1.  从旬头星开始，数至**生日**（原文：初八日除八数）。
                2.  将数到的星宿安在**子**位。
                3.  顺推至**生时**。 -> 得出结果？
            *   *待定：此部分算法较为晦涩，建议后续作为高阶功能开发，初期可先使用“日宿”作为主星（这是目前通行的做法）。*

**简化版（通行）策略**：
*   **主星** = 出生当日的二十八宿（日禽）。
*   **胎星** = 主星后一位（或前一位，视流派定）。本书原文：“主星是箕水豹，胎星就是斗木獬。” -> **胎星是主星的下一位**（按二十八宿顺序）。

### 2.3 起命宫 (Life Palace)

1.  从**子**位起正月，**逆数**至生月。
2.  从该位起子时，**顺数**至生时。
3.  该位置即为**命宫**。

### 2.4 起命星 (Life Star)

1.  **胎星**与**虚日鼠**相合（合宿歌）。
2.  从**子**位起**虚**（或合宿之星）。
3.  **顺数**至**命宫**。
4.  该位置的星宿即为**命星**。

### 2.5 起身宫 (Body Palace)

1.  计算总数：(月数 x 2) + 日数。
    *   例：八月初八 -> (8 x 2) + 8 = 24。
2.  从**子**位起，**逆数**总数。
3.  落位即为**身宫**。

### 2.6 起身星 (Body Star)

1.  取**命星**的**合宿**（六合）。
2.  从**子**位起该合宿。
3.  **顺数**至**身宫**。
4.  落位即为**身星**。

### 2.7 起流星 (Flow Stars)

*   **小限/流星**：以**胎星**作一岁，按二十八宿顺序往后顺数至虚岁年龄。
    *   例：胎星斗，1岁斗，2岁牛，3岁女...

### 2.8 起大运 (Grand Fortune)

*   **起运岁数**：根据主星属性决定。
    *   水宿：1岁起运
    *   火宿：2岁起运
    *   木宿：3岁起运
    *   金宿：4岁起运
    *   土宿：5岁起运
    *   日宿：6岁起运
    *   月宿：7岁起运
*   **排布**：
    *   男命阳年（甲丙戊庚壬）：顺行。
    *   女命阴年（乙丁己辛癸）：顺行。
    *   反之逆行。

## 3. 辅助数据表

### 3.1 二十八宿合宿表（六合）

用于计算命星、身星的起算点。

| 星宿 | 合宿 | 星宿 | 合宿 |
| :--- | :--- | :--- | :--- |
| **角** | 昴 | **奎** | 房 |
| **亢** | 胃 | **心** | 壁 |
| **氐** | 娄 | **斗** | 虚 |
| **箕** | 危 | **尾** | 室 |
| **牛** | 女 | **嘴** | 翼 |
| **参** | 张 | **柳** | 鬼 |
| **毕** | 轸 | **井** | 星 |

### 3.2 命主星生克修正（男女除补）

*   **规则**：
    *   男命：数到**牛金牛**不数（跳过）。
    *   女命：数到**女土蝠**不数（跳过）。
    *   **例外**：若生年有**闰月**，则不跳过，照常数。
